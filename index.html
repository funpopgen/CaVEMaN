<!doctype html>

<html lang="fr">
<head>
  <meta charset="utf-8">

  <title>CaVEMaN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="funpopgen">

  <link rel="stylesheet" href="https://funpopgen.github.io/CaVEMaN/css/normalize.css">
  <link rel="stylesheet" href="https://funpopgen.github.io/CaVEMaN/css/milligram.min.css">
  <link rel="stylesheet" href="https://funpopgen.github.io/CaVEMaN/css/ovac-couscous.css">
  <link rel="stylesheet" href="https://funpopgen.github.io/CaVEMaN/css/emojifyBase.min.css">
  <link rel="stylesheet" href="https://funpopgen.github.io/CaVEMaN/css/emojify.min.css">
  <link rel="stylesheet" href="https://funpopgen.github.io/CaVEMaN/css/emojify-emoticons.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWFSSDL"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <nav id="menu" class="panel" role="navigation">
        <h5>Table of Contents</h5>
                <ul>
                            <p class="text-muted">
                    Contents
                </p>

                <ul class="nav nav-pills nav-stacked">
                                            <li class="">
                            <a href="https://funpopgen.github.io/CaVEMaN/">
                                Home
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://funpopgen.github.io/CaVEMaN/">
                                Contents
                            </a>
                        </li>
                                    </ul>
                            <p class="text-muted">
                    Links
                </p>

                <ul class="nav nav-pills nav-stacked">
                                            <li class="">
                            <a href="https://github.com/funpopgen/CaVEMaN">
                                View page on github
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://github.com/funpopgen/CaVEMaN/releases/tag/v1.01">
                                Download page
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://www.nature.com/ng/journal/vaop/ncurrent/full/ng.3979.html">
                                Paper
                            </a>
                        </li>
                                    </ul>
            
                    </ul>
            </nav>
    <div class="push">
        <header>
            <a href="#menu" class="menu-link">&#9776;</a>
            <h1>CaVEMaN</h1>
            <a class="github" href="http://github.com/funpopgen/CaVEMaN" title="CaVEMaN sur Github" target="blank">
                <svg width="80" height="80" viewBox="0 0 250 250" class="github">
                    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
                    <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
                    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
                </svg>
            </a>
        </header>
        <div class="container">
                            <h1 id="caveman-causal-variant-evidence-mapping-using-non-parametric-resampling">CaVEMaN Causal Variant Evidence Mapping using Non-parametric resampling</h1>
<p>Given the results of an eQTL mapping analysis, together with the expression, genotype and phenotype files, this software will estimate the probability that the peak eQTL is causal. For more details, please see the associated <a href="https://www.nature.com/ng/journal/vaop/ncurrent/full/ng.3979.html">paper</a>.</p>
<hr />
<h2 id="contents">Contents</h2>
<ol>
<li><a href="#downloading-caveman">Downloading CaVEMaN</a></li>
<li><a href="#input-data-formats">Input data formats</a></li>
<li><a href="#creating-a-single-phenotype-bed-file-from-an-eqtl-list">Creating a single phenotype bed file from an eQTL list</a></li>
<li><a href="#running-caveman">Running CaVEMaN</a></li>
<li><a href="#extracting-peak-snps-and-estimating-causal-probabilities">Extracting peak SNPs and estimating causal probabilities</a></li>
<li><a href="#running-simulations-to-estimate-parameters">Running simulations to estimate parameters</a></li>
<li><a href="#building-from-source">Building from source</a></li>
</ol>
<hr />
<h2 id="downloading-caveman">Downloading CaVEMaN</h2>
<p>CaVEMaN binaries can be downloaded from here:</p>
<p><a href="https://github.com/funpopgen/CaVEMaN/releases/tag/v1.01"><a href="https://github.com/funpopgen/CaVEMaN/releases/tag/v1.01">https://github.com/funpopgen/CaVEMaN/releases/tag/v1.01</a></a></p>
<p>The standard binary is called CaVEMaN. Use CaVEMaN_CentOS if there is an error referring to GLIBC.</p>
<p>CaVEMaN requires tabix to be installed: <a href="https://github.com/samtools/htslib"><a href="https://github.com/samtools/htslib">https://github.com/samtools/htslib</a></a>.</p>
<p>If there are any issues, you can try <a href="#building-from-source">building from source</a>, or contact <a href="mailto:andrew.brown@unige.ch">andrew.brown@unige.ch</a>.</p>
<hr />
<h2 id="input-data-formats">Input data formats</h2>
<p>CaVEMaN uses the same data formats as fastQTL (<a href="http://fastqtl.sourceforge.net/">http://fastqtl.sourceforge.net/</a>), which the exception that the bed file should be uncompressed. To convert the fastQTL bed file run the following line:</p>
<pre><code>gunzip myphenotypefile.bed.gz</code></pre>
<p>The bed file should only contain genes for which an eQTL has been discovered, unless a set of conditional eQTLs have been produced, in which case the next section explains how to produce a new bed file from this list. This requires a list of eQTL, which should be a tab-separated file with no header, and the following fields to uniquely determine the SNP-gene pairs:</p>
<ol>
<li>Gene</li>
<li>Chromosome</li>
<li>Base pair location</li>
<li>Reference allele</li>
<li>Alternate allele</li>
</ol>
<p>The <code>--single-signal</code> and <code>--simulate</code> options can also take a covariates file. This should be tab separated, the first row should contain subject IDs, and there should be one row for each covariate.</p>
<hr />
<h2 id="creating-a-single-phenotype-bed-file-from-an-eqtl-list">Creating a single phenotype bed file from an eQTL list</h2>
<p>CaVEMaN is based on the assumption that there is only one eQTL signal in the cis window. In cases where multiple eQTLs are known for a given gene, we can produce &quot;single signal&quot; phenotypes by regressing out all but one eQTL at a time (and optionally covariates as well). Given an expression bed file (expression.bed), a genotype file (genotype.vcf.gz) and a list of eQTL (eqtl.list), we produce the file with the following command:</p>
<pre><code> CaVEMaN --single-signal --eqtl eqtl.list --bed expression.bed --vcf genotype.vcf.gz \
     --out corrected.expression.bed</code></pre>
<p>If a set of important covariates are known (covariates.txt) were included in the eQTL mapping, these can be considered as well:</p>
<pre><code> CaVEMaN --single-signal --eqtl eqtl.list --bed expression.bed --vcf genotype.vcf.gz \
     --out corrected.expression.bed --cov covariates.txt</code></pre>
<hr />
<h2 id="running-caveman">Running CaVEMaN</h2>
<p>To run CaVEMaN, all that is necessary is a bed file containing expression values (expression.bed) and a vcf file containing genotype values (genotype.vcf.gz, either the DS or GT field must be present).</p>
<p>CaVEMaN has been designed so that the full analysis can be broken up into chunks, which can be submitted as cluster jobs separately. This requires two flags (if neither are present the whole analysis will be submitted), <code>--genes</code> specifies the number of genes to be analysed in each job, <code>--job-number</code> indexes the job. Therefore, if <code>--genes 10</code> is specified, <code>--job-number 1</code> will analyse genes 1-10 in the bed file, <code>--job-number 2</code> will process genes 11-20 and so on.</p>
<p>To submit a job array, with a bed file of 9,995 genes, where each job analyses 50 genes (9,995 / 50 = 199.9, so we need to run 200 jobs to cover all genes), we would submit the following command to an LSF cluster:</p>
<pre><code> bsub -o out -J"CaVEMaN[1-200]" \
     "CaVEMaN --bed expression.bed --vcf genotype.vcf.gz --genes 50 \
     --job-number \$LSB_JOBINDEX --out results\$LSB_JOBINDEX"</code></pre>
<p>In addition, the <code>--perm</code> option allows you to set the number of bootstrap samples used in the analysis.</p>
<p>This command will produce 200 results files, results1-results200. To concatenate them together run:</p>
<pre><code> awk 'FNR&gt;1||NR==1' results* &gt; results.all</code></pre>
<p>The output should look like this:</p>
<p><img src="screenshots/CaVEMaN.results.png" alt="CaVEMaN results example" /></p>
<p>The output contains every SNP in the cis window, the first five fields specify the gene and SNP, Cor and P fields give the results of a simple correlation analysis of SNP and gene, and CaVEMaN gives the CaVEMaN score, a measure of whether this SNP is causal.</p>
<hr />
<h2 id="extracting-peak-snps-and-estimating-causal-probabilities">Extracting peak SNPs and estimating causal probabilities</h2>
<p>Once the CaVEMaN analysis is complete, we can parse the results file to extract the SNP most likely to be causal, and calculate its causal probability (using the results of simulations). To do this run the following command:</p>
<pre><code> CaVEMaN --best results.all --out results.best</code></pre>
<p>The file results.best should look like this:</p>
<p><img src="screenshots/CaVEMaN.best.png" alt="Screenshot, peak eQTL" /></p>
<p>The file contains the same fields as before, with the addition of the &quot;Probability&quot; column which gives the probability the SNP is causal.</p>
<hr />
<h2 id="running-simulations-to-estimate-parameters">Running simulations to estimate parameters</h2>
<p>CaVEMaN uses parameters estimated from eQTL data, and we have seen these parameters to be consistent over a range of sample sizes, genotype structure, sequencing pipelines and tissue types. However, it is possible that there will be cases in the future for which these parameters are not appropriate, for example, with much larger datasets than currently available. In this case new simulations can be run to estimate parameters suitable for the analysis.</p>
<p>Firstly, given a list of eQTLs, a vcf file and a bed file, run the following command to generate a dataset of simulated expression with known genetic signals that are matched to real eQTLs:</p>
<pre><code>CaVEMaN --simulate --eqtl eqtl.list --bed expression.bed --vcf genotype.vcf.gz \
     --out simulated.expression.bed</code></pre>
<p>Then, run a full CaVEMaN analysis on this file as described in the previous section, producing a results file called results.all. To estimate two parameter files (rank and weights) based on these results, run:</p>
<pre><code>CaVEMaN --get-weights --results results.all --rank new.rank --weights new.weights</code></pre>
<p>Now, to use these new parameters when running CaVEMaN, firstly run the CaVEMaN analysis specifying the <code>--rank</code> flag, i.e.:</p>
<pre><code>CaVEMaN --bed expression.bed --vcf genotype.vcf.gz --rank new.rank --out results </code></pre>
<p>Then, when extracting causal probabilities, pass the <code>--weights</code> flag:</p>
<pre><code>CaVEMaN --best results.all --weights new.weights --out results.best</code></pre>
<hr />
<h2 id="building-from-source">Building from source</h2>
<p>This requires a D compiler and a version of the GNU scientific library, version 2.1 or above.</p>
<h3 id="cloning-the-repository">Cloning the repository</h3>
<p>First, clone the repository by running:</p>
<pre><code>git clone https://github.com/funpopgen/CaVEMaN.git</code></pre>
<p>This should create a folder called CaVEMaN. Inside this folder is a file called makefile, in the first four lines we can specify the location of the D compiler and also where the gsl library is (if it is not already installed on your cluster).</p>
<h3 id="download-a-d-compiler">Download a D compiler</h3>
<p>Then, download a D compiler from either here: <a href="https://github.com/ldc-developers/ldc/releases"><a href="https://github.com/ldc-developers/ldc/releases">https://github.com/ldc-developers/ldc/releases</a></a> or here: <a href="http://dlang.org/dmd-linux.html"><a href="http://dlang.org/dmd-linux.html">http://dlang.org/dmd-linux.html</a></a> (ldc produces faster software, my experience is that dmd works better on older operating systems). Decompress the downloaded file, then edit either the first or second line of the makefile in the CaVEMaN folder so that it contains the full path to the relevant compiler, i.e. either:</p>
<p><strong>DMD := /path/to/dmd2/linux/bin64/dmd</strong></p>
<p>or</p>
<p><strong>LDC := /path/to/ldc2-1.1.0-beta2-linux-x86_64/bin/ldc2</strong></p>
<h3 id="installing-if-necessary-a-recent-version-of-the-gsl">Installing, if necessary, a recent version of the gsl</h3>
<p>First, check if a sufficiently recent version of the gsl is already installed by running:</p>
<pre><code> gsl-config --version</code></pre>
<p>If this states that version 2.1 or more recent is installed, you can move on to building the software.</p>
<p>Otherwise, download the gsl from here: <a href="http://mirror.switch.ch/ftp/mirror/gnu/gsl/gsl-2.4.tar.gz"><a href="http://mirror.switch.ch/ftp/mirror/gnu/gsl/gsl-2.4.tar.gz">http://mirror.switch.ch/ftp/mirror/gnu/gsl/gsl-2.4.tar.gz</a></a>.</p>
<p>Create a folder to install it to called gsl, then run the following commands:</p>
<pre><code>tar -xf gsl-2.4.tar.gz
cd gsl-2.4/
./configure prefix=/path/to/gsl
make
make install
cd .. &amp;&amp; rm -rf gsl-2.4.tar.gz gsl-2.4</code></pre>
<p>Then, edit the third line of the makefile to point at the gsl folder:</p>
<p><strong>GSL := /path/to/gsl</strong></p>
<h3 id="building-the-software">Building the software</h3>
<p>Now to compile the software run the following two commands:</p>
<pre><code>make test
make</code></pre>
<p>The CaVEMaN binary should be within the bin folder in the CaVEMaN directory, running</p>
<pre><code> ./bin/CaVEMaN --help</code></pre>
<p>should bring up the help.</p>
                    </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://funpopgen.github.io/CaVEMaN/js/emojify.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script src="https://funpopgen.github.io/CaVEMaN/js/bigSlide.js"></script>
    <script src="https://funpopgen.github.io/CaVEMaN/js/hide-on-scroll.js"></script>
    <script>
    $(document).ready(function() {
        $('.menu-link').bigSlide({
            'easyClose': true
        });
    });
    </script>

            
        
        
    
</body>
</html>
